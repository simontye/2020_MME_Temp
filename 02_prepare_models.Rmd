---
title: "Prepare models"
author: "Mass mortality crew"
date: "2020/05/20"
output: github_document
---

### Step 1: Load packages and data

This is a second pass at data processing to prepare data for model fitting.

```{r: Load packages and data}
# Install packages
#install.packages(c("caret"))

# Load packages
library(tidyverse)
library(caret)

# Change working directory
setwd("/Users/simontye/Documents/Research/Projects/MME_Temp/2020_MME_Temp/data/processed")

# Re-process data. Need to add in air temperature data
model_historical <- read_csv("model_historical.csv",
                             col_types = list(site_id = col_character(),
                                              state = col_character(), # Added for comparison
                                              year = col_character(),
                                              month  = col_character(),
                                              season = col_character(),
                                              summerkill = col_character(),
                                              ice_duration = col_double())) %>%
  select(-cause.category.4, -anthropogenic, -infectious, -unknown, -winterkill) %>%
  mutate(summerkill = fct_recode(summerkill,
                                 "neg" = "0",
                                 "pos" = "1"))
```

### Step 2: Partition and scale data

This partitions the data into training and testing sets, then scale thems to allow for coefficient comparison.

```{r: Partition and scale data}
# Set seed
set.seed(666)
in_training <- createDataPartition(model_historical$summerkill, p = .75, list = FALSE)

# Partition data
training <- model_historical  %>%
  slice(in_training)
testing  <- model_historical %>%
  slice(-in_training)

# Scale data
pre_proc_values <- preProcess(training, method = c("center", "scale"))
training <- predict(pre_proc_values, training) %>%
  mutate(year = as.integer(year))
testing  <- predict(pre_proc_values, testing) %>%
  mutate(summerkill = factor(testing$summerkill, 
                             levels = c("pos", "neg"), 
                             ordered = TRUE),
         year = as.integer(year))

# Change working directory
setwd("/Users/simontye/Documents/Research/Projects/MME_Temp/2020_MME_Temp/data")

# Export data
write_csv(training, "models/training.csv")
write_csv(testing,  "models/testing.csv")
```

### Step 3: In progress


